<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}H-ATS Admin{% endblock %}</title>

    <style>
        :root {
            --bg-color-black: #121212;
            --text-color-light: #ffffff;
            --header-bg-dark: #1e1e1e;
            --sidebar-bg-dark: #222222;
            --sidebar-item-hover-dark: rgba(0, 123, 255, 0.2);
            --sidebar-item-active-dark: #007bff;
            --accent-color: #007bff;
            --border-color-dark: #333333;
            --agreement-checked-bg: #1f331f;
            --sidebar-active-text-color: var(--text-color-light);
            /* â­ï¸ ì†Œì œëª© ì „ìš© ìƒ‰ìƒ ë³€ìˆ˜ ì¶”ê°€ â­ï¸ */
            --subtitle-color: #29bbff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
            background-color: var(--bg-color-black);
            color: var(--text-color-light);
        }

        .container {
            display: flex;
            width: 100%;
        }

        /* ì‚¬ìš©ì ì„¤ì • ë„ˆë¹„ 190px */
        .sidebar {
            width: 190px;
            background-color: var(--sidebar-bg-dark);
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: stretch;
            flex-shrink: 0;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar h2 {
            color: var(--text-color-light);
            text-align: center;
            margin-bottom: 30px;
            padding: 0 15px;
            font-size: 1.5em;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
        }

        .sidebar ul li {
            width: 100%;
            margin: 0;
            padding: 0;
        }

        .sidebar ul li a {
            display: block;
            padding: 15px 0;
            color: var(--text-color-light) !important;
            text-decoration: none;
            transition: background-color 0.2s, border-left-color 0.2s, opacity 0.3s;
            border-left: 5px solid transparent;
            text-align: center;
            opacity: 1.0;
            pointer-events: auto;
            font-weight: bold;
            box-sizing: border-box;
            width: 100%;
            margin: 0;
        }

        /* ë¹„í™œì„±í™”ëœ íƒ­ ìŠ¤íƒ€ì¼ */
        .sidebar ul li a.disabled {
            opacity: 0.5 !important;
            pointer-events: none !important;
            cursor: not-allowed;
        }

        /* í˜¸ë²„ ë°°ê²½ìƒ‰ì„ ì˜…ì€ íŒŒë€ìƒ‰ìœ¼ë¡œ ë³€ê²½ (ê¸€ììƒ‰ì€ ìœ ì§€) */
        .sidebar ul li a:hover {
            background-color: var(--sidebar-item-hover-dark);
            color: var(--text-color-light) !important;
            box-shadow: 0px 0px 0px rgba(0, 123, 255, 0.5);
            width: 100%;
        }

        /* í™œì„±í™”ëœ íƒ­ ìŠ¤íƒ€ì¼ */
        .sidebar ul li a.active {
            background-color: var(--accent-color);
            border-left-color: var(--accent-color);
            color: var(--text-color-light) !important;
            font-weight: bold;
            opacity: 1.0 !important;
            pointer-events: auto !important;
            box-shadow: 0px 0px 0px rgba(0, 123, 255, 0.7);
            width: 100%;
        }

        .main-content {
            flex-grow: 1;
            padding: 40px;
            background-color: var(--bg-color-black);
            margin-left: 190px;
        }

        .header {
            background-color: var(--header-bg-dark);
            color: var(--text-color-light);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .header h1 {
            margin: 0;
            font-size: 1.5em;
            border-bottom: none;
            padding-bottom: 0;
        }

        /* â­ï¸ ëª¨ë“  í˜ì´ì§€ì˜ ì¹´ë“œ(card) ì•ˆ h2 ì†Œì œëª©ì— --subtitle-color ì ìš© â­ï¸ */
        .card h2 {
            color: var(--subtitle-color);
            margin-top: 0;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.5em;
        }


        .cta-button {
            display: block;
            background-color: #dc3545;
            color: white;
            padding: 15px 0;
            border: none;
            border-radius: 0;
            cursor: pointer;
            text-decoration: none;
            font-weight: bold;
            transition: background-color 0.3s;
            width: 100%;
            margin: 0;
            text-align: center;
            font-size: 1em;
            box-sizing: border-box;
        }

        .cta-button:hover {
            background-color: #c82333;
        }

        .sidebar ul li:last-child {
            margin-bottom: 0;
        }

        /* ğŸš¨ [ìˆ˜ì •ë¨] ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ ìŠ¤íƒ€ì¼ (ë°°ê²½ íˆ¬ëª…ë„ 0.7 ë³µêµ¬) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* âœ… ìˆ˜ì •ë¨: ë’· ë°°ê²½ ë‚´ìš©ì´ ë³´ì´ë„ë¡ íˆ¬ëª…ë„(0.7) ì ìš© */
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .hidden-modal {
            display: none !important;
        }

        .modal-content {
            background-color: var(--header-bg-dark);
            /* #1e1e1e */
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-color-dark);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-header-danger {
            color: #dc3545;
            /* Red */
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .modal-text {
            color: var(--text-color-light);
            margin-bottom: 15px;
            line-height: 1.4;
            font-size: 1em;
        }

        .modal-text-danger {
            color: #dc3545;
            font-weight: bold;
            margin-bottom: 25px;
            font-size: 0.9em;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
    </style>

    {% block extra_head_styles %}{% endblock %}
    {# ëª¨ë°”ì¼ ë°˜ì‘í˜• ì½”ë“œ ì„í¬íŠ¸ #}
    {% include "my_base_mobile.html" %}

    {% block extra_style_script_head %}{% endblock %}

</head>

<body>
    <div class="sidebar-overlay"></div>
    <div class="container">
        <aside class="sidebar">
            <h2>H-ATS</h2>
            <nav>
                <ul>
                    <li><a href="/admin/agreement" {% if current_page=='/admin/agreement' %} class="active" {% endif
                            %}>ì´ìš© ì•½ê´€</a></li>
                    <li><a href="/admin/intro" {% if current_page=='/admin/intro' %} class="active" {% endif %}>ì†Œê°œ</a>
                    </li>

                    <li><a href="/admin/security" {% if current_page=='/admin/security' %} class="active"
                            {% endif %}>ë³´ì•ˆ</a></li>
                    <li><a href="/admin/korean_exchange" {% if current_page=='/admin/korean_exchange' %} class="active" {% endif %}>êµ­ë‚´ ê±°ë˜ì†Œ</a></li>
                    <li><a href="#">í•´ì™¸ ê±°ë˜ì†Œ</a></li>
                    <li><a href="/admin/messenger" {% if current_page=='/admin/messenger' %} class="active" {% endif
                            %}>ë©”ì‹ ì €</a></li>
                    <li><a href="/admin/monitoring" {% if current_page=='/admin/monitoring' %} class="active" {% endif
                            %}>ëª¨ë‹ˆí„°ë§</a></li>
                    <li><a href="/admin/settings" {% if current_page=='/admin/settings' %} class="active" {% endif %}>ì½˜ì†”
                            ì„¤ì •</a></li>

                    <li>
                        <form id="logout-form" method='post' action='/admin/logout' style="padding: 0; margin: 0;">
                            <button type='submit' id="logout-btn" class='cta-button'>
                                ë¡œê·¸ì•„ì›ƒ
                            </button>
                        </form>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <button class="menu-toggle" id="menu-toggle" aria-label="ë©”ë‰´ í† ê¸€">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <h1>{% block page_header %}H-ATS Admin{% endblock %}</h1>
            </header>

            <section>{% block content %}{% endblock %}</section>
        </main>
    </div>

    <script>
        // âœ… [í•µì‹¬] 1. ì „ì—­ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•œ ë©”ë‰´ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì •ì˜
        function updateMenuState() {
            // ì•½ê´€ ë™ì˜ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
            const agreementKey = 'agreementChecked';
            const isAgreementChecked = localStorage.getItem(agreementKey) === 'true';
            const menuLinks = document.querySelectorAll('.sidebar ul li a');

            // â­ï¸ í•­ìƒ í™œì„±í™”ë˜ì–´ì•¼ í•˜ëŠ” ë§í¬ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
            const agreementLink = document.querySelector('a[href="/admin/agreement"]');
            const settingsLink = document.querySelector('a[href="/admin/settings"]');

            // ë©”ë‰´ í´ë¦­ ì‹œ ë™ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì°¨ë‹¨í•˜ëŠ” í•¨ìˆ˜
            function checkAgreement(e) {
                const currentAgreementState = localStorage.getItem(agreementKey) === 'true';

                if (!currentAgreementState) {
                    e.preventDefault();
                    console.error("ì‚¬ìš©ì„ ê³„ì†í•˜ë ¤ë©´ 'ì´ìš© ì•½ê´€' í˜ì´ì§€ì—ì„œ ì¤‘ìš” ê³ ì§€ ë° ë©´ì±… ì‚¬í•­ì— ë™ì˜í•´ì•¼ í•©ë‹ˆë‹¤.");

                    // UI í”¼ë“œë°±: í—¤ë” ê²½ê³  í‘œì‹œ
                    const headerH1 = document.querySelector('.header h1');
                    const originalText = headerH1.textContent;
                    headerH1.textContent = "âš ï¸ 'ì´ìš© ì•½ê´€' í˜ì´ì§€ì—ì„œ ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤!";
                    setTimeout(() => {
                        headerH1.textContent = originalText;
                    }, 3000);
                }
            }

            // ê¸°ì¡´ì˜ ëª¨ë“  ë¹„í™œì„±í™” ìƒíƒœ ë° ì´ë²¤íŠ¸ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
            menuLinks.forEach(link => {
                link.classList.remove('disabled');
                link.removeEventListener('click', checkAgreement);
            });

            if (!isAgreementChecked) {
                // ë™ì˜í•˜ì§€ ì•Šì€ ê²½ìš° ë¹„í™œì„±í™” ë° í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
                menuLinks.forEach(link => {
                    // â­ï¸ 'ì´ìš© ì•½ê´€'ê³¼ 'ì½˜ì†” ì„¤ì •'ì„ ì œì™¸í•œ ëª¨ë“  ë§í¬ì— ì œí•œì„ ê²ë‹ˆë‹¤.
                    if (link !== agreementLink && link !== settingsLink) {
                        link.classList.add('disabled');
                        link.addEventListener('click', checkAgreement);
                    }
                });
            }

            console.log("ë©”ë‰´ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ. ë™ì˜ ìƒíƒœ:", isAgreementChecked);
        }
        // --------------------------------------------------------------------------

        // âš™ï¸ ê³µí†µ JS ë¡œì§
        document.addEventListener('DOMContentLoaded', () => {
            const currentPath = window.location.pathname;
            const menuLinks = document.querySelectorAll('.sidebar ul li a');
            const logoutForm = document.getElementById('logout-form'); // ë¡œê·¸ì•„ì›ƒ í¼

            // 2. ë©”ë‰´ í™œì„±í™” (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
            menuLinks.forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                }
            });

            // í¼ ì œì¶œ ì´ë²¤íŠ¸ì— ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ ì¶”ê°€ (ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì‹œ)
            if (logoutForm) {
                logoutForm.addEventListener('submit', () => {
                    // ì¿ í‚¤ ì‚­ì œì™€ ë”ë¶ˆì–´ í´ë¼ì´ì–¸íŠ¸ ìƒíƒœë„ ì •ë¦¬í•©ë‹ˆë‹¤.
                    localStorage.removeItem('agreementChecked');
                });
            }

            // âœ… [í•µì‹¬] 3. í˜ì´ì§€ ë¡œë“œ ì‹œ ë©”ë‰´ ìƒíƒœë¥¼ ì„¤ì •
            updateMenuState();

            // ==========================================================
            // 4. ì‚¬ì´ë“œë°” ë„ˆë¹„ë¥¼ í™œì„± íƒ­ ë„ˆë¹„ì— ë§ì¶”ê¸° (PC ì „ìš©)
            // ==========================================================
            const sidebar = document.querySelector('.sidebar');

            function adjustSidebarWidth() {
                // PC í™”ë©´ì—ì„œë§Œ ì ìš© (ëª¨ë°”ì¼ì—ì„œëŠ” ê³ ì • ë„ˆë¹„)
                if (window.innerWidth <= 768) {
                    if (sidebar) {
                        sidebar.style.width = '190px'; // ëª¨ë°”ì¼ì—ì„œëŠ” ê³ ì • ë„ˆë¹„
                    }
                    return;
                }

                const activeLink = document.querySelector('.sidebar ul li a.active');
                if (activeLink && sidebar) {
                    // í™œì„± ë§í¬ì˜ í…ìŠ¤íŠ¸ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
                    const activeText = activeLink.textContent.trim();

                    // í…ìŠ¤íŠ¸ ë„ˆë¹„ë¥¼ ì •í™•íˆ ì¸¡ì •í•˜ê¸° ìœ„í•œ ì„ì‹œ span ìƒì„±
                    const tempSpan = document.createElement('span');
                    tempSpan.style.visibility = 'hidden';
                    tempSpan.style.position = 'absolute';
                    tempSpan.style.whiteSpace = 'nowrap';
                    // í™œì„± ë§í¬ì™€ ë™ì¼í•œ ìŠ¤íƒ€ì¼ ì ìš©
                    const linkStyle = window.getComputedStyle(activeLink);
                    tempSpan.style.fontSize = linkStyle.fontSize;
                    tempSpan.style.fontWeight = linkStyle.fontWeight;
                    tempSpan.style.fontFamily = linkStyle.fontFamily;
                    tempSpan.style.letterSpacing = linkStyle.letterSpacing;
                    tempSpan.textContent = activeText;

                    document.body.appendChild(tempSpan);
                    const textWidth = tempSpan.offsetWidth;
                    document.body.removeChild(tempSpan);

                    // í™œì„± íƒ­ì˜ ì „ì²´ ë„ˆë¹„ = í…ìŠ¤íŠ¸ ë„ˆë¹„ + ì¢Œìš° padding (26px * 2) + ì™¼ìª½ border (5px)
                    const activeTabWidth = textWidth + 52 + 5;

                    // ì‚¬ì´ë“œë°” ë„ˆë¹„ë¥¼ í™œì„± íƒ­ ë„ˆë¹„ì™€ ì •í™•íˆ ë§ì¶¤
                    // ìµœì†Œ ë„ˆë¹„ ë³´ì¥
                    const finalWidth = Math.max(activeTabWidth, 190);
                    sidebar.style.width = finalWidth + 'px';
                } else if (sidebar) {
                    // í™œì„± ë§í¬ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë„ˆë¹„ ìœ ì§€
                    sidebar.style.width = '190px';
                }
            }

            // ì´ˆê¸° ì‹¤í–‰ ë° ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸
            // ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ì£¼ì–´ DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
            setTimeout(() => {
                adjustSidebarWidth();
            }, 100);

            window.addEventListener('resize', () => {
                adjustSidebarWidth();
            });

            // í™œì„± ë§í¬ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë„ˆë¹„ ì¡°ì •
            const observer = new MutationObserver(() => {
                setTimeout(() => {
                    adjustSidebarWidth();
                }, 50);
            });

            if (sidebar) {
                observer.observe(sidebar, {
                    childList: true,
                    subtree: true,
                    attributes: true,
                    attributeFilter: ['class']
                });
            }
        });
    </script>

    {% block page_script %}{% endblock %}

    {% block extra_style_script_body %}{% endblock %}

</body>

</html>
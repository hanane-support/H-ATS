<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{% block title %}H-ATS Admin{% endblock %}</title>

<style>
:root {
--bg-color-black: #121212; 
--text-color-light: #ffffff; 
--header-bg-dark: #1e1e1e; 
--sidebar-bg-dark: #222222; 
--sidebar-item-hover-dark: rgba(0, 123, 255, 0.2); 
--sidebar-item-active-dark: #007bff; 
--accent-color: #007bff; 
--border-color-dark: #333333; 
--agreement-checked-bg: #1f331f; 
--sidebar-active-text-color: var(--text-color-light); 
/* â­ï¸â­ï¸ ì†Œì œëª© ì „ìš© ìƒ‰ìƒ ë³€ìˆ˜ ì¶”ê°€ â­ï¸â­ï¸ */
--subtitle-color: #29bbff; 
}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
margin: 0;
padding: 0;
display: flex;
min-height: 100vh;
transition: background-color 0.3s, color 0.3s;
background-color: var(--bg-color-black);
color: var(--text-color-light);
}

.container {
display: flex;
width: 100%;
}

/* ğŸŸ¢ [ë°˜ì˜ë¨] ì‚¬ìš©ì ì„¤ì • ë„ˆë¹„ 200px */
.sidebar {
width: 190px;
background-color: var(--sidebar-bg-dark);
padding: 20px 0;
box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
display: flex;
flex-direction: column;
align-items: center;
flex-shrink: 0;
}

.sidebar h2 {
color: var(--text-color-light);
text-align: center;
margin-bottom: 30px;
padding: 0 15px;
font-size: 1.5em;
}

.sidebar ul { list-style: none; padding: 0; width: 100%; }
.sidebar ul li { width: 100%; }
.sidebar ul li a {
display: block; padding: 15px 26px;
color: var(--text-color-light) !important; 
text-decoration: none; transition: background-color 0.2s, border-left-color 0.2s, opacity 0.3s;
border-left: 5px solid transparent; text-align: center; opacity: 1.0; pointer-events: auto;
font-weight: bold;
box-sizing: border-box; 
}

/* ë¹„í™œì„±í™”ëœ íƒ­ ìŠ¤íƒ€ì¼ */
.sidebar ul li a.disabled { opacity: 0.5 !important; pointer-events: none !important; cursor: not-allowed; }

/* í˜¸ë²„ ë°°ê²½ìƒ‰ì„ ì˜…ì€ íŒŒë€ìƒ‰ìœ¼ë¡œ ë³€ê²½ (ê¸€ììƒ‰ì€ ìœ ì§€) */
.sidebar ul li a:hover { 
background-color: var(--sidebar-item-hover-dark); 
color: var(--text-color-light) !important; 
box-shadow: 0px 0px 0px rgba(0, 123, 255, 0.5); /* x-offset, y-offset, blur, color */
}

/* í™œì„±í™”ëœ íƒ­ ìŠ¤íƒ€ì¼ */
.sidebar ul li a.active {
background-color: var(--accent-color); 
border-left-color: var(--accent-color);
color: var(--text-color-light) !important; 
font-weight: bold; opacity: 1.0 !important; pointer-events: auto !important;
box-shadow: 0px 0px 0px rgba(0, 123, 255, 0.7); /* x-offset, y-offset, blur, color */
}

.main-content { flex-grow: 1; padding: 40px; background-color: var(--bg-color-black); }
.header {
background-color: var(--header-bg-dark); color: var(--text-color-light);
padding: 15px 20px; border-radius: 8px; margin-bottom: 30px; 
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); display: flex; justify-content: center; align-items: center;
}
.header h1 { margin: 0; font-size: 1.5em; border-bottom: none; padding-bottom: 0; }

/* â­ï¸ ëª¨ë“  í˜ì´ì§€ì˜ ì¹´ë“œ(card) ì•ˆ h2 ì†Œì œëª©ì— --subtitle-color ì ìš© â­ï¸ */
.card h2 {
    color: var(--subtitle-color); 
    margin-top: 0;
    padding-bottom: 10px;
    margin-bottom: 20px;
    font-size: 1.5em;
}


.cta-button {
display: inline-block; background-color: #dc3545; color: white; padding: 15px 25px; 
border: none; border-radius: 0; cursor: pointer; text-decoration: none;
font-weight: bold; 
transition: background-color 0.3s; width: 100%; margin-top: 0; text-align: center;
font-size: 1em; 
}
.cta-button:hover { background-color: #c82333; }
.sidebar ul li:last-child { margin-bottom: 0; }
</style>

{% block extra_head_styles %}{% endblock %} 

</head>

<body>
<div class="container">
<aside class="sidebar">
<h2>H-ATS</h2>
<nav>
<ul>
<li><a href="/admin/agreement"{% if current_page == '/admin/agreement' %} class="active"{% endif %}>ì´ìš© ì•½ê´€</a></li>
<li><a href="/admin/intro"{% if current_page == '/admin/intro' %} class="active"{% endif %}>ì†Œê°œ</a></li>

<li><a href="/admin/domain"{% if current_page == '/admin/domain' %} class="active"{% endif %}>ë„ë©”ì¸ ì—°ê²° ë° ë³´ì•ˆ</a></li>
<li><a href="#">êµ­ë‚´ ê±°ë˜ì†Œ</a></li>
<li><a href="#">í•´ì™¸ ê±°ë˜ì†Œ</a></li>
<li><a href="#">ë©”ì‹ ì €</a></li>
<li><a href="/admin/monitoring"{% if current_page == '/admin/monitoring' %} class="active"{% endif %}>ëª¨ë‹ˆí„°ë§</a></li>
<li><a href="/admin/settings"{% if current_page == '/admin/settings' %} class="active"{% endif %}>ì½˜ì†” ì„¤ì •</a></li>

<li>
<form id="logout-form" method='post' action='/admin/logout' style="padding: 0; margin: 0;">
<button type='submit' id="logout-btn" class='cta-button'>
ë¡œê·¸ì•„ì›ƒ
</button>
</form>
</li>
</ul>
</nav>
</aside>

<main class="main-content">
<header class="header">
<h1>{% block page_header %}H-ATS Admin{% endblock %}</h1>
</header>

<section>{% block content %}{% endblock %}</section>
</main>
</div>

<script>
// âœ… [í•µì‹¬] 1. ì „ì—­ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•œ ë©”ë‰´ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì •ì˜
function updateMenuState() {
    // ì•½ê´€ ë™ì˜ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
    const agreementKey = 'agreementChecked'; 
    const isAgreementChecked = localStorage.getItem(agreementKey) === 'true';
    const menuLinks = document.querySelectorAll('.sidebar ul li a');
    
    // â­ï¸ í•­ìƒ í™œì„±í™”ë˜ì–´ì•¼ í•˜ëŠ” ë§í¬ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    const agreementLink = document.querySelector('a[href="/admin/agreement"]'); 
    const settingsLink = document.querySelector('a[href="/admin/settings"]'); 

    // ë©”ë‰´ í´ë¦­ ì‹œ ë™ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì°¨ë‹¨í•˜ëŠ” í•¨ìˆ˜
    function checkAgreement(e) {
        const currentAgreementState = localStorage.getItem(agreementKey) === 'true'; 

        if (!currentAgreementState) {
            e.preventDefault();
            console.error("ì‚¬ìš©ì„ ê³„ì†í•˜ë ¤ë©´ 'ì´ìš© ì•½ê´€' í˜ì´ì§€ì—ì„œ ì¤‘ìš” ê³ ì§€ ë° ë©´ì±… ì‚¬í•­ì— ë™ì˜í•´ì•¼ í•©ë‹ˆë‹¤.");

            // UI í”¼ë“œë°±: í—¤ë” ê²½ê³  í‘œì‹œ
            const headerH1 = document.querySelector('.header h1');
            const originalText = headerH1.textContent;
            headerH1.textContent = "âš ï¸ 'ì´ìš© ì•½ê´€' í˜ì´ì§€ì—ì„œ ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤!";
            setTimeout(() => {
                headerH1.textContent = originalText;
            }, 3000);
        }
    }

    // ê¸°ì¡´ì˜ ëª¨ë“  ë¹„í™œì„±í™” ìƒíƒœ ë° ì´ë²¤íŠ¸ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
    menuLinks.forEach(link => {
        link.classList.remove('disabled');
        link.removeEventListener('click', checkAgreement);
    });

    if (!isAgreementChecked) {
        // ë™ì˜í•˜ì§€ ì•Šì€ ê²½ìš° ë¹„í™œì„±í™” ë° í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
        menuLinks.forEach(link => {
            // â­ï¸ 'ì´ìš© ì•½ê´€'ê³¼ 'ì½˜ì†” ì„¤ì •'ì„ ì œì™¸í•œ ëª¨ë“  ë§í¬ì— ì œí•œì„ ê²ë‹ˆë‹¤.
            if (link !== agreementLink && link !== settingsLink) { 
                link.classList.add('disabled'); 
                link.addEventListener('click', checkAgreement);
            }
        });
    }

    console.log("ë©”ë‰´ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ. ë™ì˜ ìƒíƒœ:", isAgreementChecked);
}
// --------------------------------------------------------------------------

// âš™ï¸ ê³µí†µ JS ë¡œì§
document.addEventListener('DOMContentLoaded', () => {
    const currentPath = window.location.pathname;
    const menuLinks = document.querySelectorAll('.sidebar ul li a');
    const logoutForm = document.getElementById('logout-form'); // ë¡œê·¸ì•„ì›ƒ í¼

    // 2. ë©”ë‰´ í™œì„±í™” (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    menuLinks.forEach(link => {
        if (link.getAttribute('href') === currentPath) {
            link.classList.add('active');
        }
    });

    // í¼ ì œì¶œ ì´ë²¤íŠ¸ì— ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ ì¶”ê°€ (ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì‹œ)
    if (logoutForm) {
        logoutForm.addEventListener('submit', () => {
            // ì¿ í‚¤ ì‚­ì œì™€ ë”ë¶ˆì–´ í´ë¼ì´ì–¸íŠ¸ ìƒíƒœë„ ì •ë¦¬í•©ë‹ˆë‹¤.
            localStorage.removeItem('agreementChecked'); 
        });
    }


    // âœ… [í•µì‹¬] 3. í˜ì´ì§€ ë¡œë“œ ì‹œ ë©”ë‰´ ìƒíƒœë¥¼ ì„¤ì •
    updateMenuState(); 
});
</script>

{% block page_script %}{% endblock %}
</body>
</html>
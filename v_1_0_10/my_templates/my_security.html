{% extends "my_base.html" %}

{% block title %}HAT Admin - 보안{% endblock %}

{% block extra_head_styles %}<style>
    .settings-card { background-color: var(--header-bg-dark); padding: 30px; border-radius: 8px; }
    .settings-card h2 { color: var(--accent-color); margin-top: 0; }
    .form-group { margin-bottom: 16px; }
    .status-note { color: #ddd; margin-top: 10px; }
</style>{% endblock %}

{% block page_header %}보안{% endblock %}

{% block content %}
    <section class="settings-card">
        <h2>보안 (HTTPS)</h2>
        <p class="status-note">현재 HTTPS 인증서 적용 상태를 확인하고, 필요 시 인증서를 재발급 또는 적용할 수 있습니다.</p>

        <div class="form-group">
            <label>HTTPS 상태</label>
            <div id="https-status" style="padding:10px; background:#222; border-radius:4px; color:#ddd;">상태 확인 중...</div>
        </div>

        <button id="apply-security" onclick="applySecurity()">HTTPS 재적용</button>

        <p id="sec-message" class="status-message" style="display:none;"></p>
    </section>
{% endblock %}

{% block page_script %}
<script>
    async function applySecurity(){
        const btn = document.getElementById('apply-security');
        const msg = document.getElementById('sec-message');
        btn.disabled = true;
        msg.style.display = 'block'; msg.textContent = '보안 적용 요청 전송 중...';
        try{
            const res = await fetch('/admin/update-my_security', { method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ action: 'apply' }) });
            const j = await res.json();
            if(res.ok){ msg.textContent = j.message || '성공'; }
            else{ msg.textContent = j.detail || '오류 발생'; }
        }catch(e){ msg.textContent = '통신 오류: '+e; }
        btn.disabled = false;
    }
</script>
{% endblock %}

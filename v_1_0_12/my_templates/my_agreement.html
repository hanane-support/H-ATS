{% extends "my_base.html" %}

{% block title %}ì´ìš© ì•½ê´€ - H-ATS Admin{% endblock %}

{% block page_header %}
ì´ìš© ì•½ê´€
{% endblock %}

{% block content %}
<div class="card">
<h2>H-ATS ì´ìš© ì•½ê´€</h2>
<p style="color: var(--text-color-dark); margin-top: -15px; margin-bottom: 25px; font-size: 1em;">
    <strong>H-ATS ë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ ì´ìš© ì•½ê´€ì„ ë°˜ë“œì‹œ í™•ì¸í•˜ê³  ë™ì˜í•´ì•¼ í•©ë‹ˆë‹¤.</strong>
</p>

<hr style="border: 0; height: 1px; background-color: var(--border-color-dark); margin-top: -10px; margin-bottom: 30px;">

<div class="terms-content">
    <div class="term-item">
        <input type="checkbox" id="term1" name="term1" class="term-checkbox">
        <label for="term1">
            <p><strong>1. ì‹œìŠ¤í…œì˜ ê°œë°œ ë°°ê²½ ë° ëª©ì </strong></p>
            <p>ë³¸ ì‹œìŠ¤í…œì€ ê°œë°œì (í•˜ë‚˜ë„¤) ê°€ ìë™ ë§¤ë§¤ì˜ í¸ì˜ì„±ì„ ëª©ì ìœ¼ë¡œ, ê°œì¸ì ìœ¼ë¡œ ê°œë°œ ë° êµ¬ì¶•í•œ ì‹œìŠ¤í…œì´ë©°, ëˆ„êµ¬ë‚˜ ììœ ë¡­ê²Œ í™œìš©í•  ìˆ˜ ìˆëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ì…ë‹ˆë‹¤.</p>
        </label>
    </div>

    <div class="term-item">
        <input type="checkbox" id="term2" name="term2" class="term-checkbox">
        <label for="term2">
            <p><strong>2. íˆ¬ì ì±…ì„ ë° ë©´ì±… ì‚¬í•­</strong></p>
            <p>ë³¸ ì‹œìŠ¤í…œì€ ì‚¬ìš©ìì˜ ë³´ì¡° ë„êµ¬ë¡œì„œì˜ ì—­í• ë§Œì„ ìˆ˜í–‰í•  ë¿, ë°˜ë“œì‹œ ìˆ˜ìµì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë©°, ì˜ˆìƒì¹˜ ëª»í•œ ê²°ê³¼ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš© ë° íˆ¬ì ê²°ì •ì— ë”°ë¥¸ ì¬ì •ì  ì±…ì„ ë° ìœ„í—˜ì€ ì‚¬ìš©ì ë³¸ì¸ì—ê²Œ ê·€ì†ë©ë‹ˆë‹¤.</p>
        </label>
    </div>

    <div class="term-item">
        <input type="checkbox" id="term3" name="term3" class="term-checkbox">
        <label for="term3">
            <p><strong>3. ì‹œìŠ¤í…œì˜ ì™¸ë¶€ í™˜ê²½ ë³€ìˆ˜</strong></p>
            <p>ì œì–´ê°€ ë¶ˆê°€ëŠ¥í•œ ì™¸ë¶€ì ì¸ ìš”ì¸ì— ì˜í•´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì¬ì •ì  ì±…ì„ ë° ìœ„í—˜ì€ ì‚¬ìš©ì ë³¸ì¸ì—ê²Œ ê·€ì†ë©ë‹ˆë‹¤.</p>
            <ul>
                <li><strong>ë‚ ì”¨</strong>: ìš°ì²œ, ê¸°ìƒ ì•…í™” ë“±ìœ¼ë¡œ ì¸í•œ ë¶ˆì•ˆì •í•œ í†µì‹  ì¥ì• ëŠ” ì „ì„¸ê³„ì ì¸ ë¬¸ì œì…ë‹ˆë‹¤.</li>
                <li><strong>VULTR</strong>: ì„œë²„ ì´ì „, ì¦ì¶•, ê°ì†Œ, ì¬ì •ë¹„, ì—…ê·¸ë ˆì´ë“œ, ì ê²€ ë“± ìœ ì§€ ë³´ìˆ˜ë¥¼ ìœ„í•œ ì¼ì‹œ ì¤‘ì§€, ì •ì§€ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë©°, ì„¤ì • ë¯¸ìˆ™, êµ¬ë… ë§Œë£Œ, ë¯¸ê²°ì œ ë“±ì˜ ì‹¤ìˆ˜ë¡œ ì¸í•´ ì„ëŒ€ ì„œë²„ì— ë³€ìˆ˜ê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li><strong>íŠ¸ë ˆì´ë”©ë·°</strong>: ì—…ë°ì´íŠ¸, ì„œë²„ ë¶€í•˜, ë²„ê·¸ ë“± íŠ¸ë ˆì´ë”©ë·° ìì²´ ë¬¸ì œë¡œ ì›¹í›… ì „ì†¡ì´ ì§€ì—°, ëˆ„ë½, ì†Œì‹¤ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li><strong>H-ATS</strong>: íŠ¸ë ˆì´ë”©ë·°ì—ì„œ ë³´ë‚¸ ì›¹í›…ì´ ì§€ì—°, ëˆ„ë½, ì†Œì‹¤ë˜ì–´ ì˜¨ì „í•œ ë°ì´í„°ë¥¼ ë°›ì§€ ëª»í•˜ë©´ ì‘ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë˜í•œ ê±°ë˜ì†Œë¡œ ì˜¨ì „í•œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ë”ë¼ë„, ê±°ë˜ì†Œì—ì„œ ë°›ì•„ì£¼ì§€ ì•Šìœ¼ë©´ ì‘ë™ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                <li><strong>ê±°ë˜ì†Œ</strong>: ì²´ê²° ìˆ˜ëŸ‰, ì‹œê°„, ê°€ê²© ë“±ì˜ ì˜¤ì°¨ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë©°, ì •ì±… ë³€ê²½, ì˜ë„ì ì¸ ì²´ê²° ì œí•œ, ì§€ì—°, ì¡°ì‘, íì—… ë“±ì˜ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.</li>
                <li><strong>FASTAPI</strong>: ì„œë²„ê°€ ê³„ì† ì—´ë¦° ìƒíƒœë¡œ ì‘ë™í•˜ë¯€ë¡œ ê°„í˜ˆì ìœ¼ë¡œ ë³‘ëª©í˜„ìƒ, ì„±ëŠ¥ì €í•˜, ì²˜ë¦¬ ì§€ì—° ë“±ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li><strong>CADDY</strong>: ì„œë²„ê°€ ê³„ì† ì—´ë¦° ìƒíƒœë¡œ ì‘ë™í•˜ë©° ê³µì‹ ì‚¬ì´íŠ¸ ì •ì±…ì— ë”°ë¼ ë³´ì•ˆ ì¸ì¦ì— ë¬¸ì œê°€ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            </ul>
        </label>
    </div>

    <div class="term-item">
        <input type="checkbox" id="term4" name="term4" class="term-checkbox">
        <label for="term4">
            <p><strong>4. ì‹œìŠ¤í…œì˜ ë‚´ë¶€ í™˜ê²½ ë³€ìˆ˜</strong></p>
            <p>ë²„ê·¸, ì—…ë°ì´íŠ¸, ë¶ˆì™„ì „ ì½”ë”© ë“± ë‚´ë¶€ì ì¸ ìš”ì¸ì— ì˜í•´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì¬ì •ì  ì±…ì„ ë° ìœ„í—˜ì€ ì‚¬ìš©ì ë³¸ì¸ì—ê²Œ ê·€ì†ë©ë‹ˆë‹¤.</p>
        </label>
    </div>
    
    <div class="term-item">
        <input type="checkbox" id="term5" name="term5" class="term-checkbox">
        <label for="term5">
            <p><strong>5. ì•½ê´€ì˜ íš¨ë ¥</strong></p>
            <p><strong>ì•½ê´€ ë™ì˜:</strong> ì´ìš© ì•½ê´€ì„ ëª¨ë‘ í™•ì¸í•˜ê³  ë™ì˜ ë²„íŠ¼ì„ ëˆ„ë¥¸ ì‚¬ìš©ìëŠ” ê´€ë¦¬ì ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì‚¬ìš© ë° ëª¨ë“  íˆ¬ì ê²°ì • ê²°ê³¼ì— ëŒ€í•œ ì±…ì„ì„ ì‚¬ìš©ì ë³¸ì¸ì´ ê·€ì† ë°›ëŠ” ê²ƒì— ë™ì˜í•©ë‹ˆë‹¤.</p>
            <p><strong>ì•½ê´€ ì² íšŒ:</strong> ì•½ê´€ ë™ì˜ë¥¼ í•˜ì§€ ì•Šê±°ë‚˜, ì•½ê´€ ì² íšŒ ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜, VULTR ì„œë²„ë¥¼ ì¬ì‹œì‘, ì¬ì„¤ì¹˜, ì‚­ì œí•˜ëŠ” ê²½ìš° ì•½ê´€ íš¨ë ¥ì€ ì¦‰ì‹œ ìƒì‹¤ë©ë‹ˆë‹¤.</p>
        </label>
    </div>
</div>

<div class="agreement-button-container" data-server-checked="{{ is_agreement_checked }}">
    <button id="agreement-button" class="agreement-button" disabled>
    </button>
</div>
<p id="agreement-message" style="
    text-align: center; 
    margin-top: 20px; 
    font-weight: bold; 
    color: var(--text-color-light); 
    min-height: 20px; /* ë©”ì‹œì§€ ì˜ì—­ í™•ë³´ */
    font-size: 1.1em; /* ğŸŒŸ ê¸€ì í¬ê¸° 1.1emìœ¼ë¡œ ìƒí–¥ ì¡°ì • */
"></p>

</div>
{% endblock %}

{% block extra_head_styles %}
<style>
/* ğŸ”´ ê²½ê³  ìƒ‰ìƒ ë³€ìˆ˜ (var(--warning-color)) ì •ì˜ ì¶”ê°€ */
:root {
    /* [ë°˜ì˜] ì² íšŒ ë²„íŠ¼ ìƒ‰ìƒ #b0202e ì‚¬ìš© (JS ë¡œì§ì˜ ì¼ê´€ì„±ì„ ìœ„í•´ --warning-colorë¥¼ #dc3545ë¡œ ìœ ì§€í•˜ê³ , ì‹¤ì œ ë²„íŠ¼ ë°°ê²½ì€ hoverì—ë§Œ #b0202e ì‚¬ìš©) */
    --warning-color: #dc3545; 
    /* [ì¶”ê°€] ì² íšŒ ë©”ì‹œì§€ ê¸€ììƒ‰ ì „ìš© ë³€ìˆ˜ (ê¸°ë³¸ê°’ì€ warning-colorì™€ ë™ì¼) */
    --revoke-message-color: var(--warning-color); 
    /* ë²„íŠ¼ ë¹„í™œì„±í™” ìƒ‰ìƒ */
    --disabled-color: #555; /* ì–´ë‘ìš´ íšŒìƒ‰ */
}

/* ì•½ê´€ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
.card {
background-color: var(--header-bg-dark); /* #1e1e1e */
padding: 30px;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
border: 1px solid var(--border-color-dark);
}
.card h2 {
color: var(--subtitle-color); /* â­ï¸ ë³€ê²½ë¨ */
margin-top: 0;
padding-bottom: 10px;
margin-bottom: 20px;
font-size: 1.5em;
}
.terms-content {
background-color: var(--sidebar-bg-dark); /* #222222 */
padding: 20px;
border-radius: 6px;
border: 1px solid var(--border-color-dark);
/* í™”ë©´ ë†’ì´ì— ë§ì¶° ìµœëŒ€í•œ í™•ì¥ë˜ë„ë¡ max-height ìˆ˜ì • */
max-height: calc(75vh - 220px); 
overflow-y: auto;
margin-bottom: 30px;
}

/* ğŸŒŸ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ ì¶”ê°€ (WebKit ë¸Œë¼ìš°ì €ìš©) */
.terms-content::-webkit-scrollbar {
    width: 8px; /* ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ */
}

.terms-content::-webkit-scrollbar-thumb {
    background-color: #555; /* ì—„ì§€ ë¶€ë¶„ (ì›€ì§ì´ëŠ” ë§‰ëŒ€) ìƒ‰ìƒ: ì¤‘ê°„ íšŒìƒ‰ */
    border-radius: 10px;
    border: 2px solid var(--sidebar-bg-dark); /* ë°°ê²½ìƒ‰ê³¼ ë¹„ìŠ·í•˜ê²Œ ê²½ê³„ ì„¤ì • */
}

.terms-content::-webkit-scrollbar-track {
    background-color: var(--sidebar-bg-dark); /* íŠ¸ë™(ë°°ê²½) ìƒ‰ìƒ: ì•½ê´€ ë‚´ìš© ë°°ê²½ê³¼ ë™ì¼ */
}

/* ğŸŒŸ ì²´í¬ë°•ìŠ¤ì™€ ì•½ê´€ ë‚´ìš©ì„ ìœ„í•œ ë ˆì´ì•„ì›ƒ */
.term-item {
    display: flex; /* ê°€ë¡œ ì •ë ¬ */
    align-items: flex-start; /* ì„¸ë¡œ ì •ë ¬ ìƒë‹¨ ë§ì¶¤ */
    margin-bottom: 25px;
}
.term-item p {
    margin: 0 0 15px 0; /* ë‹¨ë½ í•˜ë‹¨ ì—¬ë°± ìœ ì§€, ìƒë‹¨ ì—¬ë°± ì œê±° */
    line-height: 1.6;
    color: var(--text-color-dark);
}
.term-item strong {
    color: var(--text-color-light);
}
.term-item label {
    display: block;
    margin-left: 15px; /* ì²´í¬ë°•ìŠ¤ì™€ ë‚´ìš© ì‚¬ì´ ê°„ê²© */
    width: 100%;
}
.term-checkbox {
    /* [ë°˜ì˜] ì²´í¬ë°•ìŠ¤ í…Œë‘ë¦¬ë¥¼ í°ìƒ‰ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ í•­ìƒ ë³´ì´ë„ë¡ í•¨ */
    appearance: none; 
    width: 18px;
    height: 18px;
    border: 2px solid white; 
    border-radius: 4px;
    cursor: pointer;
    background-color: transparent;
    flex-shrink: 0; 
    margin-top: 5px; 
}
.term-checkbox:checked {
    background-color: var(--accent-color); /* ì²´í¬ ì‹œ íŒŒë€ìƒ‰ ë°°ê²½ */
    border-color: var(--accent-color);
}
.term-checkbox:checked::before {
    content: 'âœ“';
    display: block;
    color: white;
    font-size: 14px;
    line-height: 16px;
    text-align: center;
}

/* [ë°˜ì˜] ì•½ê´€ 3ë²ˆ í•­ëª©ì˜ ë¦¬ìŠ¤íŠ¸ ê°„ê²© ì¡°ì • */
.term-item ul li {
    margin-bottom: 10px; 
}
.term-item ul li:last-child {
    margin-bottom: 0;
}


/* ğŸŒŸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.agreement-button-container {
margin-top: 30px;
text-align: center; /* ë²„íŠ¼ ì¤‘ì•™ ì •ë ¬ */
}

.agreement-button {
padding: 8px 30px;
font-size: 1.1em;
font-weight: bold;
border: none;
border-radius: 8px;
cursor: pointer;
transition: background-color 0.3s, border-color 0.3s;
width: 100%; /* ë„ˆë¹„ í™•ì¥ */
max-width: 150px; /* ìµœëŒ€ ë„ˆë¹„ ì œí•œ */
color: white; /* í…ìŠ¤íŠ¸ í°ìƒ‰ */
box-shadow: none !important; 
}

/* ğŸ”’ ë¹„í™œì„±í™” ìƒíƒœ (ê¸°ë³¸) - íšŒìƒ‰ */
.agreement-button:disabled {
    background-color: var(--disabled-color); /* ì–´ë‘ìš´ íšŒìƒ‰ */
    cursor: not-allowed;
    opacity: 0.6;
}

/* ğŸ”„ ë™ì˜ ìƒíƒœ (í™œì„±í™” ì‹œ: ê¸°ë³¸ì€ ë°ê²Œ, í˜¸ë²„ëŠ” ì–´ë‘¡ê²Œ) */
.agreement-button:not(:disabled).agree {
    background-color: var(--accent-color); /* [ë°˜ì˜] #007bff */
    cursor: pointer;
    opacity: 1;
}
.agreement-button:not(:disabled).agree:hover {
    background-color: #0056b3; /* ì–´ë‘ìš´ íŒŒë€ìƒ‰ */
}

/* ğŸ”„ ì² íšŒ ìƒíƒœ (í™œì„±í™” ì‹œ: ê¸°ë³¸ì€ ë°ê²Œ, í˜¸ë²„ëŠ” ì–´ë‘¡ê²Œ) */
.agreement-button:not(:disabled).revoke {
    background-color: var(--warning-color); /* [ë°˜ì˜] #dc3545 */
    cursor: pointer;
    opacity: 1;
}
.agreement-button:not(:disabled).revoke:hover {
    background-color: #b0202e; /* ì–´ë‘ìš´ ë¹¨ê°„ìƒ‰ b0202e */
}
</style>
{% endblock %}

{% block page_script %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const agreementButton = document.getElementById('agreement-button');
    const agreementContainer = document.querySelector('.agreement-button-container');
    const messageDisplay = document.getElementById('agreement-message'); 
    const localStorageKey = 'agreementChecked'; 
    const revokeMessageKey = 'revokeMessage';
    const checkboxes = document.querySelectorAll('.term-checkbox');

    // Helper: ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜.
    function displayMessage(text, isError = false) {
        messageDisplay.textContent = text;
        // ì—ëŸ¬(ì² íšŒ) ë˜ëŠ” ê²½ê³  ë©”ì‹œì§€ì¼ ê²½ìš° ê¸€ì ìƒ‰ì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½
        if (isError) {
            messageDisplay.style.color = 'var(--revoke-message-color)';
        } else {
            // ì„±ê³µ (ë™ì˜) ë©”ì‹œì§€ì¼ ê²½ìš° ê¸€ì ìƒ‰ì„ íŒŒë€ìƒ‰ìœ¼ë¡œ ë³€ê²½
            messageDisplay.style.color = 'var(--accent-color)';
        }
    }
    
    // ì´ˆê¸° ë¡œë”© ì‹œ ë©”ì‹œì§€ë¥¼ ë¹„ì›ë‹ˆë‹¤.
    function clearMessage() {
        messageDisplay.textContent = '';
        messageDisplay.style.color = 'var(--text-color-light)';
    }

    // HTML data ì†ì„±ì—ì„œ ì„œë²„ ìƒíƒœë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const isServerCheckedString = agreementContainer.getAttribute('data-server-checked');
    let isAgreed = (isServerCheckedString === 'True' || isServerCheckedString === 'true'); 

    // 1. Initial state setup based on Server State
    // ì•½ê´€ ì² íšŒ í›„ ë©”ì‹œì§€ í‘œì‹œ ë¡œì§
    const pendingRevokeMessage = localStorage.getItem(revokeMessageKey);
    
    if (pendingRevokeMessage) {
        // ìƒˆë¡œê³ ì¹¨ í›„ ì² íšŒ ì„±ê³µ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê³ , í‚¤ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.
        displayMessage(pendingRevokeMessage, true);
        localStorage.removeItem(revokeMessageKey);
    } else if (isAgreed) {
        checkboxes.forEach(cb => cb.checked = true);
        // ì•½ê´€ ë™ì˜ ìƒíƒœë¼ë©´, ë™ì˜ ë©”ì‹œì§€ë¥¼ ê³ ì •ì ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
        displayMessage("âœ… í˜„ì¬ ì•½ê´€ ë™ì˜ ìƒíƒœì…ë‹ˆë‹¤. ê´€ë¦¬ì ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    } else {
        clearMessage();
    }
    
    localStorage.setItem(localStorageKey, isAgreed ? 'true' : 'false');
    toggleUI(isAgreed); 
    updateButtonState(); // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸

    // 2. Function to update UI (Button text and color)
    function toggleUI(agreedState) {
        if (agreedState) {
            agreementButton.textContent = "ì•½ê´€ ì² íšŒ";
            agreementButton.classList.remove('agree');
            agreementButton.classList.add('revoke');
        } else {
            agreementButton.textContent = "ì•½ê´€ ë™ì˜";
            agreementButton.classList.remove('revoke');
            agreementButton.classList.add('agree');
        }

        if (typeof updateMenuState === 'function') {
            updateMenuState();
        }
    }

    // 3. ì²´í¬ë°•ìŠ¤ ìƒíƒœ í™•ì¸ ë° ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™” í•¨ìˆ˜
    function updateButtonState() {
        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
        
        if (isAgreed || allChecked) {
            agreementButton.disabled = false;
        } else {
            agreementButton.disabled = true;
        }
    }

    // 4. ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            updateButtonState();
        });
    });

    // 5. Function to handle button click
    async function handleButtonClick() {
        const currentState = isAgreed;
        const targetState = !currentState;

        // --- ë™ì˜ (Agree: false -> true) ì²˜ë¦¬ ---
        if (targetState === true) {
            try {
                const response = await fetch('/admin/agreement_confirm', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({}) 
                });

                if (response.ok) {
                    isAgreed = true; 
                    localStorage.setItem(localStorageKey, 'true');
                    toggleUI(isAgreed);
                    updateButtonState(); 
                    // ë™ì˜ ì„±ê³µ ì‹œ ë©”ì‹œì§€ë¥¼ ê³ ì •
                    displayMessage("âœ… ì‚¬ìš© ë™ì˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ì ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."); 
                } else {
                    const errorData = await response.json();
                    alert('âš ï¸ ë™ì˜ ìƒíƒœ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + (errorData.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                console.error('Fetch error:', error);
                alert("ğŸš« ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì—°ê²° ì‹¤íŒ¨.");
            }
        } 
        // --- ì² íšŒ (Revoke: true -> false) ì²˜ë¦¬ ---
        else { 
            try {
                // ìƒˆë¡œê³ ì¹¨ ì „ ë©”ì‹œì§€ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•©ë‹ˆë‹¤.
                const revokeMessageText = "âŒ ì•½ê´€ ë™ì˜ê°€ ì² íšŒë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ì ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                localStorage.setItem(revokeMessageKey, revokeMessageText);
                
                // ìƒˆë¡œê³ ì¹¨ ì „ì— ë©”ì‹œì§€ë¥¼ ì¦‰ì‹œ í‘œì‹œí•©ë‹ˆë‹¤.
                displayMessage(revokeMessageText, true);

                const response = await fetch('/admin/agreement_revoke', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({}) 
                });

                if (response.ok) {
                    isAgreed = false; 
                    localStorage.setItem(localStorageKey, 'false');
                    
                    // ì•½ê´€ ì² íšŒ ì‹œ ë¬´ì¡°ê±´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    // ë©”ì‹œì§€ë¥¼ ë³¼ ìˆ˜ ìˆë„ë¡ ì•½ê°„ì˜ ë”œë ˆì´ í›„ ìƒˆë¡œê³ ì¹¨
                    setTimeout(() => { 
                        window.location.reload(); 
                    }, 500); 
                    
                } else {
                    // ì„œë²„ ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë©”ì‹œì§€ í‚¤ë¥¼ ì‚­ì œí•˜ê³  ì˜¤ë¥˜ ì²˜ë¦¬
                    localStorage.removeItem(revokeMessageKey);
                    const errorData = await response.json();
                    alert('âš ï¸ ë™ì˜ ì² íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + (errorData.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë©”ì‹œì§€ í‚¤ë¥¼ ì‚­ì œí•˜ê³  ì˜¤ë¥˜ ì²˜ë¦¬
                localStorage.removeItem(revokeMessageKey);
                console.error('Fetch error:', error);
                alert("ğŸš« ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì—°ê²° ì‹¤íŒ¨.");
            }
        }
    }

    // 6. Event listener
    agreementButton.addEventListener('click', handleButtonClick);
});
</script>
{% endblock %}